app-id: org.geany.Geany
runtime: org.freedesktop.Sdk
runtime-version: '24.08'
sdk: org.freedesktop.Sdk

command: geany
rename-icon: geany
copy-icon: true
rename-desktop-file: geany.desktop

finish-args:
  - --share=ipc
  - --socket=fallback-x11
  - --socket=wayland
  - --share=network
  - --filesystem=host
  - --filesystem=xdg-run/geany:create
  
add-extensions:
  org.codeblocks.codeblocks.Plugin:
    version: stable
    directory: tools
    subdirectories: true
    no-autodownload: true
    autodelete: true
    add-ld-path: lib
    
modules:
  - name: tools
    buildsystem: simple
    build-commands:
      - install -d /app/tools
      
  - name: libXmu #xterm
    buildsystem: autotools
    sources:
      - type: git
        url: https://gitlab.freedesktop.org/xorg/lib/libxmu.git
        tag: "libXmu-1.2.1"
        commit: 792f80402ee06ce69bca3a8f2a84295999c3a170

  - name: libXaw #xterm
    buildsystem: autotools
    sources:
      - type: git
        url: https://gitlab.freedesktop.org/xorg/lib/libxaw.git
        tag: "libXaw-1.0.16"
        commit: f14ba54e9c7e415a05e33dd0b3b5f96e5de05c8b

  - name: xterm
    buildsystem: autotools
    config-opts:
      - --disable-full-tgetent
    sources:
      - type: archive
        url: https://invisible-island.net/archives/xterm/xterm-396.tgz
        sha256: 43f94b6d0eecb4219a99f46352e746f2ab5558e40d922d411acff96cc778a6a5
        
  - shared-modules/intltool/intltool-0.51.json

  - name: fast-float #vte
    buildsystem: cmake-ninja
    sources:
      - type: git
        url: https://github.com/fastfloat/fast_float.git
        tag: v8.0.2
        commit: 50a80a73ab2ab256ba1c3bf86923ddd8b4202bc7
  
  - name: vte #geany-plugins
    buildsystem: meson
    config-opts:
      - -Ddocs=false
      - -Dvapi=false
      - -Dgir=false
      - -Dgtk4=false
    sources:
      - type: git
        url: https://gitlab.gnome.org/GNOME/vte.git
        tag: 0.80.3
        commit: 02eaf1997d904dbfb792e2ae9ae0ba8b82f117f1
            
  - name: lxml
    buildsystem: simple
    build-options:
      cflags: -fpermissive
    build-commands:
      - pip3 install --verbose --exists-action=i --no-index --find-links="file://${PWD}" --prefix=${FLATPAK_DEST} "lxml" --no-build-isolation
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/c5/ed/60eb6fa2923602fba988d9ca7c5cdbd7cf25faa795162ed538b527a35411/lxml-6.0.0.tar.gz
        sha256: 032e65120339d44cdc3efc326c9f660f5f7205f3a535c1fdbf898b29ea01fb72
      
  - name: geany
    buildsystem: autotools
    config-opts:
      - --disable-html-docs
    post-install:
      - install -Dm644 -t /app/share/appdata org.geany.Geany.appdata.xml
      - mv /app/bin/geany /app/bin/geany-bin 
    sources:
      - type: git
        url: https://github.com/geany/geany.git
        commit: cb5ff3cf0b63971010e60ea2feedd1a0181c1ace
        tag: 2.1.0
      - type: file
        path: org.geany.Geany.appdata.xml
        
  - name: ide-flatpak-wrapper
    buildsystem: meson
    config-opts:
      - -Deditor_binary=/app/bin/geany-bin
      - -Deditor_title=Geany
      - -Dprogram_name=geany
      - -Dfirst_run_template=ide-first-run.txt
      - -Dsdk_version=24.08
    sources:
      - type: git
        url: https://github.com/flathub/ide-flatpak-wrapper.git
        commit: 445fdd20b2f083fe12ac9ac61c1a30864da8a8d1
      - type: file
        path: wrapper/ide-first-run.txt

  # - geany-plugins.yml
