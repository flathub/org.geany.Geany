app-id: org.geany.Geany
runtime: org.freedesktop.Sdk
runtime-version: '24.08'
sdk: org.freedesktop.Sdk

command: geany
rename-icon: geany
copy-icon: true
rename-desktop-file: geany.desktop

finish-args:
  - --share=ipc
  - --socket=fallback-x11
  - --socket=wayland
  - --share=network
  - --filesystem=host
  - --filesystem=xdg-run/geany:create

modules:
  - name: libXmu #xterm
    buildsystem: autotools
    sources:
      - type: git
        url: https://gitlab.freedesktop.org/xorg/lib/libxmu.git
        tag: "libXmu-1.2.1"
        commit: 792f80402ee06ce69bca3a8f2a84295999c3a170

  - name: libXaw #xterm
    buildsystem: autotools
    sources:
      - type: git
        url: https://gitlab.freedesktop.org/xorg/lib/libxaw.git
        tag: "libXaw-1.0.16"
        commit: f14ba54e9c7e415a05e33dd0b3b5f96e5de05c8b

  - name: xterm
    buildsystem: autotools
    config-opts:
      - --disable-full-tgetent
    sources:
      - type: archive
        url: https://invisible-island.net/archives/xterm/xterm-396.tgz
        sha256: 43f94b6d0eecb4219a99f46352e746f2ab5558e40d922d411acff96cc778a6a5
  - shared-modules/intltool/intltool-0.51.json
  - name: vte
    buildsystem: meson
    config-opts:
      - -Ddocs=false
      - -Dvapi=false
      - -Dgir=false
    sources:
      - type: git
        url: https://gitlab.gnome.org/GNOME/vte.git
        tag: 0.72.4
        commit: 45d815431c08ff5a3cf076cde5edd43054773c4a
        x-checker-data:
          type: git
          tag-pattern: ^([\d.]+)$
          versions:
            <: '0.73'

  - name: cython #lxml
    buildsystem: simple
    build-commands:
      - pip3 install --ignore-installed --no-index --find-links="file://${PWD}" --prefix=${FLATPAK_DEST} cython
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/18/40/7b17cd866158238db704965da1b5849af261dbad393ea3ac966f934b2d39/cython-3.1.2.tar.gz
        sha256: 6bbf7a953fa6762dfecdec015e3b054ba51c0121a45ad851fa130f63f5331381
            
  - name: lxml
    buildsystem: simple
    build-options:
      cflags: -fpermissive
    build-commands:
      - pip3 install --ignore-installed --no-index --find-links="file://${PWD}" --prefix=${FLATPAK_DEST} lxml
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/c5/ed/60eb6fa2923602fba988d9ca7c5cdbd7cf25faa795162ed538b527a35411/lxml-6.0.0.tar.gz
        sha256: 032e65120339d44cdc3efc326c9f660f5f7205f3a535c1fdbf898b29ea01fb72
      
  - name: geany
    buildsystem: meson
    # config-opts:
      # - --disable-api-docs
    sources:
      - type: git
        url: https://github.com/geany/geany.git
        commit: cb5ff3cf0b63971010e60ea2feedd1a0181c1ace
        tag: 2.1.0
      - type: file
        path: org.geany.Geany.appdata.xml
    post-install:
      - install -Dm644 -t /app/share/metainfo org.geany.Geany.appdata.xml

# If you want to build Geany without plugins, just remove the line below.
  - geany-plugins.yml
