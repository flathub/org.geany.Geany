app-id: org.geany.Geany
runtime: org.freedesktop.Sdk
runtime-version: '22.08'
sdk: org.freedesktop.Sdk

command: geany
rename-icon: geany
copy-icon: true
rename-desktop-file: geany.desktop

finish-args:
  - --share=ipc
  - --socket=x11
  - --socket=fallback-x11
  - --socket=wayland
  - --share=network
  - --filesystem=host
  - --filesystem=xdg-run/geany:create

modules:
  - shared-modules/intltool/intltool-0.51.json
  - name: vte
    buildsystem: meson
    config-opts:
      - -Ddocs=false
      - -Dvapi=false
      - -Dgir=false
    sources:
      - type: git
        url: https://gitlab.gnome.org/GNOME/vte.git
        tag: 0.69.92
        commit: f9501d9f4666bcec598baafe4ec7a99ec59aad99
        x-checker-data:
          type: git
          tag-pattern: '^([\d.]+)$'
  - name: geany
    config-opts:
      - --disable-api-docs
    sources:
      - type: archive
        url: https://download.geany.org/geany-1.38.tar.bz2
        sha256: abff176e4d48bea35ee53037c49c82f90b6d4c23e69aed6e4a5ca8ccd3aad546
        x-checker-data:
          type: html
          url: https://www.geany.org/download/releases
          pattern: '(https://download.geany.org/geany-([\d\.]+).tar.bz2)'
      - type: file
        path: org.geany.Geany.appdata.xml
      - type: shell
        commands:
          - sed -i 's/firefox/xdg-open/' src/keyfile.c
    post-install:
      - install -Dm644 -t /app/share/metainfo org.geany.Geany.appdata.xml
